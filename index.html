<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
#map { height:100vh; }
.custom-icon { text-align:center; }

/* å³ä¸Šãƒ¬ã‚¤ãƒ¤ãƒ¼UI */
#control-wrapper {
  position:absolute; top:95px; right:15px; z-index:1200;
}
.icon-button {
  width:40px; height:40px; background:#007bff; color:white;
  border-radius:50%; text-align:center; line-height:40px;
  font-size:24px; cursor:pointer;
}
#controls {
  display:none; width:200px; background:white; padding:5px;
  border-radius:4px; box-shadow:0 2px 5px rgba(0,0,0,.3);
  max-height:65vh; overflow:auto; font-size:12px;
}
#control-wrapper:hover #controls { display:block; }

/* æƒ…å ± */
#info-wrapper {
  position:fixed; top:95px; left:10px; z-index:1300;
}
#infoPopup {
  display:none; width:260px; background:pink;
  padding:10px; border:2px solid gray; font-size:10pt;
}

/* æ¤œç´¢UI */
#search-wrapper {
  position:fixed; top:190px; left:10px; z-index:1300;
}
#search-btn {
  position: fixed; left: 10px; top: 150px;
  width:40px; height:40px;
  background:#28a745; color:#fff;
  border-radius:50%;
  text-align:center; line-height:40px;
  font-size:20px; cursor:pointer;
  z-index:1000;
}
#search-panel {
  display:none; width:230px; background:white;
  padding:8px; margin-top:5px; border-radius:6px;
  box-shadow:0 2px 5px rgba(0,0,0,.3); font-size:12px;
}
#search-results {
  max-height:150px; overflow:auto; margin-top:5px;
}
.search-item { cursor:pointer; }
.search-item:hover { background:#eee; }

/* ãƒã‚¦ã‚¹ã‚’è¿‘ã¥ã‘ã‚‹ã¨æ¤œç´¢ãƒ‘ãƒãƒ«è¡¨ç¤º */
#search-wrapper:hover #search-panel {
  display: block;
}

/* ç‚¹æ»… */
.blink { animation:blink 1s 3; }
@keyframes blink {
  0%{transform:scale(1);}
  50%{transform:scale(1.8);}
  100%{transform:scale(1);}
}
</style>
</head>

<body>

<div id="control-wrapper">
  <div class="icon-button">ğŸ› ï¸</div>
  <div id="controls">
    <button id="selectAllBtn">ã™ã¹ã¦é¸æŠ</button>
    <button id="deselectAllBtn">ã™ã¹ã¦è§£é™¤</button><br>

      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ01"> äºŒæ¬¡åŒ»ç™‚åœ(æµ·éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ02"> ã€ƒ  (å°¾å¼µæ±éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ03"> ã€ƒ  (å°¾å¼µè¥¿éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ04"> ã€ƒ  (å°¾å¼µåŒ—éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ05"> ã€ƒ  (çŸ¥å¤šåŠå³¶)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ06"> ã€ƒ  (è¥¿ä¸‰æ²³åŒ—éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ07"> ã€ƒ  (è¥¿ä¸‰æ²³å—éƒ¨è¥¿)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ08"> ã€ƒ  (è¥¿ä¸‰æ²³å—éƒ¨æ±)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ09"> ã€ƒ  (æ±ä¸‰æ²³åŒ—éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ10"> ã€ƒ  (æ±ä¸‰æ²³å—éƒ¨)</label><br>
      <label><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ11"> ã€ƒ  (åå¤å±‹ãƒ»å°¾å¼µä¸­éƒ¨)</label><br>

<label><input type="checkbox" class="layer-toggle" value="ç—…é™¢"> ç—…é™¢</label><br>
<label><input type="checkbox" class="layer-toggle" value="è¨ºç™‚æ‰€"> è¨ºç™‚æ‰€</label><br>
<label><input type="checkbox" class="layer-toggle" value="æ­¯ç§‘"> æ­¯ç§‘</label><br>
<label><input type="checkbox" class="layer-toggle" value="åŠ©ç”£é™¢"> åŠ©ç”£é™¢</label><br>
<label><input type="checkbox" class="layer-toggle" value="è–¬å±€"> è–¬å±€</label><br>

    </div>
  </div>
  <div id="info-wrapper" onmouseenter="showInfo()" onmouseleave="hideInfo()">
    <div style="background-color: white; padding: 5px; border-radius: 8px; display: inline-block; box-shadow: 0 0 2px rgba(0,0,0,0.3);">
      <span style="font-size: 24px; cursor: pointer;">â„¹ï¸</span>
    </div>

    <div id="infoPopup">
      <span style="color:red;">ã€€ã€€ã€€â˜…</span>ç—…é™¢
      <span style="color:blue;">&hearts;</span>è¨ºç™‚æ‰€
      <span style="color:orange;">â™£</span>æ­¯ç§‘
      <span style="color:green;">â™ </span>è–¬å±€<br>
      <span style="color:red;">ã€€ã€€ã€€â– </span>åŠ©ç”£é™¢
      <span style="color:black;">â–²</span>ä»‹è­·<br>

    ã€  å‡ºå…¸ã€‘<br>
      åŒ»ç™‚æƒ…å ±ãƒãƒƒãƒˆï¼ˆåšç”ŸåŠ´åƒçœï¼‰<br>
      (2025å¹´12æœˆ1æ—¥ç¾åœ¨)<br>
      ä»‹è­·äº‹æ¥­æ‰€æ¤œç´¢ï¼ˆåšç”ŸåŠ´åƒçœï¼‰<br>
      (2025å¹´6æœˆ1æ—¥ç¾åœ¨)<br>
      e-Statå›½å‹¢èª¿æŸ»2020å¹´<br>
      Google API<br>
      Mapbox API<br>

      ã€æ©Ÿèƒ½ã€‘<br>
      åœ°å›³å¤‰æ›´ã€åŒ»ç™‚åœå¢ƒç•Œç·šè¡¨ç¤ºã€æ–½è¨­é¸æŠ<br>
      æ¤œç´¢æ©Ÿèƒ½(andæ¤œç´¢)<br>
      äººå£è¡¨ç¤ºï¼ˆå¢ƒç•Œç·šè¡¨ç¤ºæ™‚ï¼‰<br>

      ã€åˆ©ç”¨è¦ç´„ã€‘<br>
      æœ¬ãƒ„ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚<br>
      https://sites.google.com/view/indexm <br>
      å½“è©²ã‚µã‚¤ãƒˆã®åˆ©ç”¨è¦ç´„ã‚’ã”ç¢ºèªãã ã•ã„ã€‚<br>
      ä½œæˆè€…:Mana48FanClub<br>
    </div>
  </div>

  <div id="search-wrapper">
    <div id="search-btn" onclick="toggleSearch()">ğŸ”</div>
    <div id="search-panel">
      <input type="text" id="search-input" placeholder="æ¤œç´¢å…¥åŠ›ã™ã‚‹(andæ¤œç´¢)..." style="width:100%; box-sizing:border-box; padding:5px;">
      <div id="search-results"></div>
    </div>
  </div>

  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    var baseLayers = {
      "æ¨™æº–åœ°å›³": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 20,
        attribution: 'Â© OpenStreetMap contributors'
      }),
      "èˆªç©ºå†™çœŸ": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles Â© Esri'
      }),
      "ãƒˆãƒã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯åœ°å›³": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles Â© Esri'
      }),
      "ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«åœ°å›³": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles Â© Esri'
      }),
      "ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒãƒƒãƒ—": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles Â© Esri'
      })
    };
    
    var map = L.map('map', {
      center: [35.18041273208532, 136.90612213810965],
      zoom: 18,
      layers: [baseLayers["æ¨™æº–åœ°å›³"]],
      attributionControl: true
    });

    L.control.layers(baseLayers, null, { position: 'topright', collapsed: true }).addTo(map);
    var layerGroups = {};
    var searchLayer = L.layerGroup().addTo(map);

    // å…±é€šå‡¦ç†é–¢æ•°
    function loadChomeLayer(index) {
      const filename = `geo_0_ç”ºä¸ç›®å¢ƒç•Œ${String(index).padStart(2, '0')}.geojson`;
      const layerName = `ç”ºä¸ç›®å¢ƒç•Œ${String(index).padStart(2, '0')}`;

      fetch(filename)
        .then(res => res.json())
        .then(data => {
          const chomeLayer = L.geoJSON(data, {
            style: {
              color: "red",
              weight: 1,
              fillOpacity: 0.03
            },
            onEachFeature: function(feature, layer) {
              const name = feature.properties["ç”ºä¸ç›®å"] || "ä¸æ˜";
              const pop = feature.properties["JINKO"] || "ä¸æ˜";
              layer.bindTooltip(name, { direction: "center", permanent: false });
              layer.bindTooltip(`<strong>${name}</strong><br>äººå£: ${pop}`, { direction: "center", permanent: false });

            }
          });
          layerGroups[layerName] = chomeLayer;
        });
    }

    // ä¸€æ‹¬èª­ã¿è¾¼ã¿
    for (let i = 1; i <= 11; i++) {
      loadChomeLayer(i);
    }


        fetch("geo_23_1.geojson")
          .then(res => res.json())
          .then(data => {
            var layer = L.geoJSON(data, {
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                  icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="color:red; font-size:30px;">â˜…</div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                  })
                })
                .bindTooltip(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong>`,
                  {
                    direction: "top",
                    sticky: true
                  }
                )
                .bindPopup(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong><br>
                   ${feature.properties["url2"]
                     ? `<a href="${feature.properties["url2"]}" target="_blank" rel="noopener noreferrer">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>`
                     : "-"}<br>
                   ${feature.properties["url"]
                     ? `<a href="${feature.properties["url"]}" target="_blank" rel="noopener noreferrer">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆã®ãƒšãƒ¼ã‚¸</a>`
                     : "-"}`
                );
              }
            });
            layerGroups["ç—…é™¢"] = layer;
          });
    
        fetch("geo_23_2.geojson")
          .then(res => res.json())
          .then(data => {
            var layer = L.geoJSON(data, {
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                  icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="color:blue; font-size:40px;">â™¥</div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                  })
                })
                .bindTooltip(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong>`,
                  {
                    direction: "top",
                    sticky: true
                  }
                )
                .bindPopup(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong><br>
                   ${feature.properties["url2"]
                     ? `<a href="${feature.properties["url2"]}" target="_blank" rel="noopener noreferrer">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>`
                     : "-"}<br>
                   ${feature.properties["url"]
                     ? `<a href="${feature.properties["url"]}" target="_blank" rel="noopener noreferrer">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆã®ãƒšãƒ¼ã‚¸</a>`
                     : "-"}`
                );
              }
            });
            layerGroups["è¨ºç™‚æ‰€"] = layer;
          });
    
        fetch("geo_23_3.geojson")
          .then(res => res.json())
          .then(data => {
            var layer = L.geoJSON(data, {
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                  icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="color:orange; font-size:40px;">â™£</div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                  })
                })
                .bindTooltip(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong>`,
                  {
                    direction: "top",
                    sticky: true
                  }
                )
                .bindPopup(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong><br>
                   ${feature.properties["url2"]
                     ? `<a href="${feature.properties["url2"]}" target="_blank" rel="noopener noreferrer">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>`
                     : "-"}<br>
                   ${feature.properties["url"]
                     ? `<a href="${feature.properties["url"]}" target="_blank" rel="noopener noreferrer">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆã®ãƒšãƒ¼ã‚¸</a>`
                     : "-"}`
                );
              }
            });
            layerGroups["æ­¯ç§‘"] = layer;
          });
    
        fetch("geo_23_4.geojson")
          .then(res => res.json())
          .then(data => {
            var layer = L.geoJSON(data, {
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                  icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="color:red; font-size:40px;">â– </div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                  })
                })
                .bindTooltip(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong>`,
                  {
                    direction: "top",
                    sticky: true
                  }
                )
                .bindPopup(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong><br>
                   ${feature.properties["url2"]
                     ? `<a href="${feature.properties["url2"]}" target="_blank" rel="noopener noreferrer">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>`
                     : "-"}<br>
                   ${feature.properties["url"]
                     ? `<a href="${feature.properties["url"]}" target="_blank" rel="noopener noreferrer">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆã®ãƒšãƒ¼ã‚¸</a>`
                     : "-"}`
                );
              }
            });
            layerGroups["åŠ©ç”£é™¢"] = layer;
          });
    
        fetch("geo_23_5.geojson")
          .then(res => res.json())
          .then(data => {
            var layer = L.geoJSON(data, {
              pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                  icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="color:green; font-size:40px;">â™ </div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                  })
                })
                .bindTooltip(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong>`,
                  {
                    direction: "top",
                    sticky: true
                  }
                )
                .bindPopup(
                  `<strong>${feature.properties["å†…å®¹"] || "-"}</strong><br>
                   ${feature.properties["url2"]
                     ? `<a href="${feature.properties["url2"]}" target="_blank" rel="noopener noreferrer">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>`
                     : "-"}<br>
                   ${feature.properties["url"]
                     ? `<a href="${feature.properties["url"]}" target="_blank" rel="noopener noreferrer">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆã®ãƒšãƒ¼ã‚¸</a>`
                     : "-"}`
                );
              }
            });
            layerGroups["è–¬å±€"] = layer;
          });
    
    document.querySelectorAll('.layer-toggle').forEach(function(cb) {
      cb.addEventListener('change', function() {
        const label = this.value;
        if (layerGroups[label]) {
          if (this.checked) {
            layerGroups[label].addTo(map);
          } else {
            map.removeLayer(layerGroups[label]);
          }
        }
      });
    });

    document.getElementById('selectAllBtn').addEventListener('click', function() {
      document.querySelectorAll('.layer-toggle').forEach(cb => {
        cb.checked = true;
        const label = cb.value;
        if (layerGroups[label]) layerGroups[label].addTo(map);
      });
    });

    document.getElementById('deselectAllBtn').addEventListener('click', function() {
      document.querySelectorAll('.layer-toggle').forEach(cb => {
        cb.checked = false;
        const label = cb.value;
        if (layerGroups[label]) map.removeLayer(layerGroups[label]);
      });
    });

    function showInfo() { document.getElementById('infoPopup').style.display = 'block'; }
    function hideInfo() { document.getElementById('infoPopup').style.display = 'none'; }

// æ¤œç´¢ãƒ‘ãƒãƒ«ã®é–‹é–‰
    function toggleSearch() {
      const panel = document.getElementById('search-panel');
      panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
    }

    // æ¤œç´¢å‡¦ç†
    document.getElementById('search-input').addEventListener('input', function(e) {
        const input = e.target.value.trim().toLowerCase();
        const resultsDiv = document.getElementById('search-results');
        resultsDiv.innerHTML = '';
        searchLayer.clearLayers();

        if (!input) return;

    // ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã£ãŸè¤‡æ•°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        const keywords = input.split(/\s+/);

        for (let label in layerGroups) {
            layerGroups[label].eachLayer(function(layer) {
                if (!layer.feature || !layer.feature.properties) return;

                const name = (layer.feature.properties["å†…å®¹"] || "").toLowerCase();
                if (!name) return;

                // ANDæ¤œç´¢: å…¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã‹
                const match = keywords.every(k => name.includes(k));
                if (match) {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.style.padding = '5px';
                    div.innerText = layer.feature.properties["å†…å®¹"];

                    div.onclick = function() {
                        searchLayer.clearLayers();
                        const latlng = layer.getLatLng();
                        const iconHtml = layer.options.icon.options.html;

                        L.marker(latlng, {
                            icon: L.divIcon({
                                className: 'custom-icon blink',
                                html: iconHtml,
                                iconSize: [32, 32],
                                iconAnchor: [16, 16]
                            })
                        })
                        .bindPopup(layer.getPopup().getContent())
                        .addTo(searchLayer)
                        .openPopup();

                        map.setView(latlng, 17);
                    };

                    resultsDiv.appendChild(div);
                }
            });
        }
    });

    function searchLayers() {
      const input = document.getElementById("search-input").value.trim().toLowerCase();
      const keywords = input.split(/\s+/);

      document.querySelectorAll(".layer-toggle").forEach(cb => {
        const label = cb.value.toLowerCase();
        const match = keywords.every(k => label.includes(k));
        cb.parentElement.style.display = match ? "block" : "none";
      });
    }
    
  </script>

</body>
</html>
