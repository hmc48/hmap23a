<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<style>
body { margin:0; padding:0; overflow:hidden; font-family: sans-serif; }
#map { height:100vh; width:100vw; z-index:1; }
.custom-icon { text-align:center; }
.circle-btn {
  width:48px; height:48px; border-radius:50%; text-align:center; line-height:48px;
  box-shadow:0 2px 8px rgba(0,0,0,0.3); cursor:pointer; font-size:24px; z-index:2000;
  position:fixed; background:white;
}
#control-btn { top:15px; right:15px; background:#007bff; color:white; }
#controls {
  display:none; position:fixed; top:70px; right:15px; width:220px; 
  background:white; padding:15px; border-radius:8px; z-index:2000;
  max-height:75vh; overflow-y:auto; box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
#search-btn { top:75px; right:15px; background:#28a745; color:white; }
#search-panel {
  display:none; position:fixed; top:130px; right:15px; width:220px;
  background:white; padding:10px; border-radius:8px; z-index:2000;
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
#info-btn { top:135px; right:15px; background:#ff69b4; color:white; }
#info-panel {
  display:none; position:fixed; bottom:20px; left:20px; right:20px;
  background:rgba(255,255,255,0.95); padding:15px; border-radius:10px;
  z-index:3000; box-shadow:0 -2px 10px rgba(0,0,0,0.2); font-size:14px;
}
.section-title { font-weight:bold; margin-top:10px; margin-bottom:5px; border-bottom:1px solid #eee; }
.layer-item { margin-bottom: 8px; font-size: 14px; display: flex; align-items: center; }
input[type="checkbox"], input[type="radio"] { transform: scale(1.3); margin-right: 10px; }
button.menu-sub-btn { margin: 5px 1%; padding: 8px; width: 46%; font-size: 11px; }
.blink { animation:blink 1s 3; }
@keyframes blink { 0%{transform:scale(1);} 50%{transform:scale(2);} 100%{transform:scale(1);} }
</style>
</head>
<body>
  <div id="control-btn" class="circle-btn" onclick="togglePanel('controls')">ğŸ› ï¸</div>
  <div id="controls">
    <div class="section-title">ä¸€æ‹¬æ“ä½œ</div>
    <button class="menu-sub-btn" id="selectAllBtn">å…¨ã¦é¸æŠ</button>
    <button class="menu-sub-btn" id="deselectAllBtn">è§£é™¤</button>
    <div class="section-title">åœ°å›³ã®ç¨®é¡</div>
    <label class="layer-item"><input type="radio" name="baseLayer" value="æ¨™æº–" checked> æ¨™æº–ãƒãƒƒãƒ—</label>
    <label class="layer-item"><input type="radio" name="baseLayer" value="å†™çœŸ"> èˆªç©ºå†™çœŸ</label>
    <div class="section-title">è¡¨ç¤ºãƒ¬ã‚¤ãƒ¤ãƒ¼</div>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ01"> æµ·éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ02"> å°¾å¼µæ±éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ03"> å°¾å¼µè¥¿éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ04"> å°¾å¼µåŒ—éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ05"> çŸ¥å¤šåŠå³¶åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ06"> è¥¿ä¸‰æ²³åŒ—éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ07"> è¥¿ä¸‰æ²³å—éƒ¨è¥¿åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ08"> è¥¿ä¸‰æ²³å—éƒ¨æ±åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ09"> æ±ä¸‰æ²³åŒ—éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ10"> æ±ä¸‰æ²³å—éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ11"> åå¤å±‹ãƒ»å°¾å¼µä¸­éƒ¨åŒ»ç™‚åœ</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç—…é™¢"> ç—…é™¢</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="è¨ºç™‚æ‰€"> è¨ºç™‚æ‰€</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="æ­¯ç§‘"> æ­¯ç§‘</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="åŠ©ç”£é™¢"> åŠ©ç”£é™¢</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="è–¬å±€"> è–¬å±€</label>

  </div>
  <div id="search-btn" class="circle-btn" onclick="togglePanel('search-panel')">ğŸ”</div>
  <div id="search-panel">
    <input type="text" id="search-input" placeholder="ä¾‹: åå¤å±‹ ç—…é™¢" style="width:100%; padding:10px; box-sizing:border-box;">
    <div id="search-results" style="max-height:200px; overflow-y:auto; margin-top:10px;"></div>
  </div>
  <div id="info-btn" class="circle-btn" onclick="togglePanel('info-panel')">i</div>
  <div id="info-panel" onclick="this.style.display='none'">
    <strong>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—</strong><br>å‡ºå…¸ï¼šåšç”ŸåŠ´åƒçœãƒ‡ãƒ¼ã‚¿<br>ä½œæˆï¼šMana48FanClub<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>
  </div>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const baseLayers = {
      "æ¨™æº–": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OSM' }),
      "å†™çœŸ": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' })
    };
    const map = L.map('map', { center: [35.18, 136.90], zoom: 15, zoomControl: false, layers: [baseLayers["æ¨™æº–"]] });

    function togglePanel(id) {
      const p = document.getElementById(id);
      const isVisible = p.style.display === 'block';
      ['controls', 'search-panel', 'info-panel'].forEach(i => document.getElementById(i).style.display = 'none');
      if(!isVisible) p.style.display = 'block';
    }

    const layerGroups = {};
    const searchLayer = L.layerGroup().addTo(map);

    function loadChomeLayer(index) {
      const idx = String(index).padStart(2, '0'); // ã“ã“ã¯JSãªã®ã§padStartã§OK
      fetch(`geo_0_ç”ºä¸ç›®å¢ƒç•Œ${idx}.geojson`).then(res => res.json()).then(data => {
          layerGroups[`ç”ºä¸ç›®å¢ƒç•Œ${idx}`] = L.geoJSON(data, {
            style: { color: "red", weight: 1, fillOpacity: 0.05 },
            onEachFeature: (f, l) => { l.bindPopup(`<strong>${f.properties["ç”ºä¸ç›®å"]}</strong><br>äººå£: ${f.properties["JINKO"]}`); }
          });
      }).catch(e => {});
    }
    for (let i = 1; i <= 11; i++) loadChomeLayer(i);

    document.querySelectorAll('input[name="baseLayer"]').forEach(radio => {
      radio.addEventListener('change', function() {
        for (let key in baseLayers) map.removeLayer(baseLayers[key]);
        baseLayers[this.value].addTo(map);
      });
    });

    fetch("geo_23_1.geojson").then(res => res.json()).then(data => {
      layerGroups["ç—…é™¢"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:red; font-size:32px;">â˜…</div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            ${f.properties["url2"] ? `<a href="${f.properties["url2"]}" target="_blank">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : "-"} | 
            ${f.properties["url"] ? `<a href="${f.properties["url"]}" target="_blank">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : "-"}`)
      });
    });
    
    fetch("geo_23_2.geojson").then(res => res.json()).then(data => {
      layerGroups["è¨ºç™‚æ‰€"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:blue; font-size:42px;">â™¥</div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            ${f.properties["url2"] ? `<a href="${f.properties["url2"]}" target="_blank">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : "-"} | 
            ${f.properties["url"] ? `<a href="${f.properties["url"]}" target="_blank">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : "-"}`)
      });
    });
    
    fetch("geo_23_3.geojson").then(res => res.json()).then(data => {
      layerGroups["æ­¯ç§‘"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:orange; font-size:42px;">â™£</div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            ${f.properties["url2"] ? `<a href="${f.properties["url2"]}" target="_blank">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : "-"} | 
            ${f.properties["url"] ? `<a href="${f.properties["url"]}" target="_blank">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : "-"}`)
      });
    });
    
    fetch("geo_23_4.geojson").then(res => res.json()).then(data => {
      layerGroups["åŠ©ç”£é™¢"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:red; font-size:42px;">â– </div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            ${f.properties["url2"] ? `<a href="${f.properties["url2"]}" target="_blank">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : "-"} | 
            ${f.properties["url"] ? `<a href="${f.properties["url"]}" target="_blank">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : "-"}`)
      });
    });
    
    fetch("geo_23_5.geojson").then(res => res.json()).then(data => {
      layerGroups["è–¬å±€"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:green; font-size:42px;">â™ </div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            ${f.properties["url2"] ? `<a href="${f.properties["url2"]}" target="_blank">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : "-"} | 
            ${f.properties["url"] ? `<a href="${f.properties["url"]}" target="_blank">åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : "-"}`)
      });
    });
    
    document.querySelectorAll('.layer-toggle').forEach(cb => {
      cb.addEventListener('change', function() {
        const g = layerGroups[this.value];
        if (g) this.checked ? g.addTo(map) : map.removeLayer(g);
      });
    });

    document.getElementById('selectAllBtn').onclick = () => {
      document.querySelectorAll('.layer-toggle').forEach(cb => { cb.checked = true; cb.dispatchEvent(new Event('change')); });
    };
    document.getElementById('deselectAllBtn').onclick = () => {
      document.querySelectorAll('.layer-toggle').forEach(cb => { cb.checked = false; cb.dispatchEvent(new Event('change')); });
    };

    // ANDæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯
    document.getElementById('search-input').oninput = function(e) {
      const val = e.target.value.toLowerCase().trim();
      const resDiv = document.getElementById('search-results');
      resDiv.innerHTML = '';
      if(!val) return;
      const keywords = val.split(/[\sã€€]+/);
      for (let label in layerGroups) {
        if (!layerGroups[label]) continue;
        layerGroups[label].eachLayer(l => {
          if (!l.feature || !l.feature.properties["å†…å®¹"]) return;
          const name = l.feature.properties["å†…å®¹"].toLowerCase();
          const isMatch = keywords.every(kw => name.includes(kw));
          if(isMatch) {
            const item = document.createElement('div');
            item.style = "padding:8px; border-bottom:1px solid #eee; font-size:13px; cursor:pointer;";
            item.innerText = l.feature.properties["å†…å®¹"];
            item.onclick = () => {
              searchLayer.clearLayers();
              const m = L.marker(l.getLatLng(), {
                icon: L.divIcon({ className:'custom-icon blink', html: l.options.icon.options.html, iconSize:[40,40], iconAnchor:[20,20] })
              }).addTo(searchLayer).bindPopup(l.getPopup().getContent()).openPopup();
              map.setView(l.getLatLng(), 17);
              togglePanel('search-panel');
            };
            resDiv.appendChild(item);
          }
        });
      }
    };
  </script>
</body>
</html>
