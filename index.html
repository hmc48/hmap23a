<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
body { margin:0; padding:0; overflow:hidden; }
#map { height:100vh; width:100vw; z-index:1; }
.custom-icon { text-align:center; }

/* å…±é€šãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
.circle-btn {
  width:48px; height:48px; border-radius:50%; text-align:center; line-height:48px;
  box-shadow:0 2px 8px rgba(0,0,0,0.3); cursor:pointer; font-size:24px; z-index:2000;
  position:fixed; background:white;
}

/* ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®šãƒ‘ãƒãƒ« */
#control-btn { top:15px; right:15px; background:#007bff; color:white; }
#controls {
  display:none; position:fixed; top:70px; right:15px; width:220px; 
  background:white; padding:15px; border-radius:8px; z-index:2000;
  max-height:70vh; overflow-y:auto; box-shadow:0 4px 15px rgba(0,0,0,0.2);
}

/* æ¤œç´¢ãƒ‘ãƒãƒ« */
#search-btn { top:75px; right:15px; background:#28a745; color:white; }
#search-panel {
  display:none; position:fixed; top:130px; right:15px; width:220px;
  background:white; padding:10px; border-radius:8px; z-index:2000;
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}

/* ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
#info-btn { top:135px; right:15px; background:#ff69b4; color:white; }
#info-panel {
  display:none; position:fixed; bottom:20px; left:20px; right:20px;
  background:rgba(255,255,255,0.95); padding:15px; border-radius:10px;
  z-index:3000; box-shadow:0 -2px 10px rgba(0,0,0,0.2); font-size:14px;
}

.layer-item { margin-bottom: 8px; font-size: 14px; display: block; }
input[type="checkbox"] { transform: scale(1.3); margin-right: 10px; }
button.menu-sub-btn { margin: 5px 0; padding: 8px; width: 48%; font-size: 12px; }

/* ç‚¹æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.blink { animation:blink 1s 3; }
@keyframes blink {
  0%{transform:scale(1);} 50%{transform:scale(2);} 100%{transform:scale(1);}
}
</style>
</head>

<body>
  <div id="control-btn" class="circle-btn" onclick="togglePanel('controls')">ğŸ› ï¸</div>
  <div id="controls">
    <button class="menu-sub-btn" id="selectAllBtn">å…¨ã¦é¸æŠ</button>
    <button class="menu-sub-btn" id="deselectAllBtn">è§£é™¤</button>
    <hr>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ01"> äºŒæ¬¡åŒ»ç™‚åœ(æµ·éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ02"> ã€ƒ (å°¾å¼µæ±éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ03"> ã€ƒ (å°¾å¼µè¥¿éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ04"> ã€ƒ (å°¾å¼µåŒ—éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ05"> ã€ƒ (çŸ¥å¤šåŠå³¶)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ06"> ã€ƒ (è¥¿ä¸‰æ²³åŒ—éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ07"> ã€ƒ (è¥¿ä¸‰æ²³å—éƒ¨è¥¿)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ08"> ã€ƒ (è¥¿ä¸‰æ²³å—éƒ¨æ±)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ09"> ã€ƒ (æ±ä¸‰æ²³åŒ—éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ10"> ã€ƒ (æ±ä¸‰æ²³å—éƒ¨)</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç”ºä¸ç›®å¢ƒç•Œ11"> ã€ƒ (åå¤å±‹ãƒ»ä¸­éƒ¨)</label>
<label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç—…é™¢"> ç—…é™¢</label>
<label class="layer-item"><input type="checkbox" class="layer-toggle" value="è¨ºç™‚æ‰€"> è¨ºç™‚æ‰€</label>
<label class="layer-item"><input type="checkbox" class="layer-toggle" value="æ­¯ç§‘"> æ­¯ç§‘</label>
<label class="layer-item"><input type="checkbox" class="layer-toggle" value="åŠ©ç”£é™¢"> åŠ©ç”£é™¢</label>
<label class="layer-item"><input type="checkbox" class="layer-toggle" value="è–¬å±€"> è–¬å±€</label>

  </div>

  <div id="search-btn" class="circle-btn" onclick="togglePanel('search-panel')">ğŸ”</div>
  <div id="search-panel">
    <input type="text" id="search-input" placeholder="æ–½è¨­åã§æ¤œç´¢..." style="width:100%; padding:10px; box-sizing:border-box;">
    <div id="search-results" style="max-height:150px; overflow-y:auto; margin-top:10px;"></div>
  </div>

  <div id="info-btn" class="circle-btn" onclick="togglePanel('info-panel')">i</div>
  <div id="info-panel" onclick="this.style.display='none'">
    <strong>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—</strong><br>
    å‡ºå…¸ï¼šåšç”ŸåŠ´åƒçœãƒ‡ãƒ¼ã‚¿<br>
    <a href="https://sites.google.com/view/indexm" target="_blank">åˆ©ç”¨è¦ç´„ãƒ»è©³ç´°ã¯ã“ã¡ã‚‰</a><br>
    ä½œæˆï¼šMana48FanClub<br>
    <small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const baseLayers = {
      "æ¨™æº–": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OSM' }),
      "å†™çœŸ": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' })
    };
    
    const map = L.map('map', {
      center: [35.18, 136.90],
      zoom: 15,
      zoomControl: false,
      layers: [baseLayers["æ¨™æº–"]]
    });

    // ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
    function togglePanel(id) {
      const p = document.getElementById(id);
      const isVisible = p.style.display === 'block';
      // ä¸€æ—¦å…¨éƒ¨é–‰ã˜ã‚‹
      ['controls', 'search-panel', 'info-panel'].forEach(i => document.getElementById(i).style.display = 'none');
      if(!isVisible) p.style.display = 'block';
    }

    const layerGroups = {};
    const searchLayer = L.layerGroup().addTo(map);

    function loadChomeLayer(index) {
      const idx = String(index).padStart(2, '0');
      fetch(`geo_0_ç”ºä¸ç›®å¢ƒç•Œ${idx}.geojson`)
        .then(res => res.json())
        .then(data => {
          layerGroups[`ç”ºä¸ç›®å¢ƒç•Œ${idx}`] = L.geoJSON(data, {
            style: { color: "red", weight: 1, fillOpacity: 0.05 },
            onEachFeature: (f, l) => {
              l.bindPopup(`<strong>${f.properties["ç”ºä¸ç›®å"]}</strong><br>äººå£: ${f.properties["JINKO"]}`);
            }
          });
        }).catch(e => console.log(idx + " not found"));
    }
    for (let i = 1; i <= 11; i++) loadChomeLayer(i);

    fetch("geo_23_1.geojson").then(res => res.json()).then(data => {
      layerGroups["ç—…é™¢"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:red; font-size:32px;">â˜…</div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            <a href="${f.properties["url2"] || "#"}" target="_blank">HP</a> | 
            <a href="${f.properties["url"] || "#"}" target="_blank">è©³ç´°</a>`)
      });
    });
    
    fetch("geo_23_2.geojson").then(res => res.json()).then(data => {
      layerGroups["è¨ºç™‚æ‰€"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:blue; font-size:42px;">â™¥</div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            <a href="${f.properties["url2"] || "#"}" target="_blank">HP</a> | 
            <a href="${f.properties["url"] || "#"}" target="_blank">è©³ç´°</a>`)
      });
    });
    
    fetch("geo_23_3.geojson").then(res => res.json()).then(data => {
      layerGroups["æ­¯ç§‘"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:orange; font-size:42px;">â™£</div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            <a href="${f.properties["url2"] || "#"}" target="_blank">HP</a> | 
            <a href="${f.properties["url"] || "#"}" target="_blank">è©³ç´°</a>`)
      });
    });
    
    fetch("geo_23_4.geojson").then(res => res.json()).then(data => {
      layerGroups["åŠ©ç”£é™¢"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:red; font-size:42px;">â– </div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            <a href="${f.properties["url2"] || "#"}" target="_blank">HP</a> | 
            <a href="${f.properties["url"] || "#"}" target="_blank">è©³ç´°</a>`)
      });
    });
    
    fetch("geo_23_5.geojson").then(res => res.json()).then(data => {
      layerGroups["è–¬å±€"] = L.geoJSON(data, {
        pointToLayer: (f, latlng) => L.marker(latlng, {
          icon: L.divIcon({
            className: 'custom-icon',
            html: `<div style="color:green; font-size:42px;">â™ </div>`,
            iconSize: [40, 40], iconAnchor: [20, 20]
          })
        }).bindPopup(`<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
            <a href="${f.properties["url2"] || "#"}" target="_blank">HP</a> | 
            <a href="${f.properties["url"] || "#"}" target="_blank">è©³ç´°</a>`)
      });
    });
    
    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll('.layer-toggle').forEach(cb => {
      cb.addEventListener('change', function() {
        const g = layerGroups[this.value];
        if (g) this.checked ? g.addTo(map) : map.removeLayer(g);
      });
    });

    document.getElementById('selectAllBtn').onclick = () => {
      document.querySelectorAll('.layer-toggle').forEach(cb => { cb.checked = true; cb.dispatchEvent(new Event('change')); });
    };
    document.getElementById('deselectAllBtn').onclick = () => {
      document.querySelectorAll('.layer-toggle').forEach(cb => { cb.checked = false; cb.dispatchEvent(new Event('change')); });
    };

    // æ¤œç´¢å‡¦ç†
    document.getElementById('search-input').oninput = function(e) {
      const val = e.target.value.toLowerCase();
      const resDiv = document.getElementById('search-results');
      resDiv.innerHTML = '';
      if(!val) return;

      for (let label in layerGroups) {
        layerGroups[label].eachLayer(l => {
          const name = (l.feature.properties["å†…å®¹"] || "").toLowerCase();
          if(name.includes(val)) {
            const item = document.createElement('div');
            item.style = "padding:8px; border-bottom:1px solid #eee; font-size:13px;";
            item.innerText = l.feature.properties["å†…å®¹"];
            item.onclick = () => {
              searchLayer.clearLayers();
              const m = L.marker(l.getLatLng(), {
                icon: L.divIcon({ className:'custom-icon blink', html: l.options.icon.options.html, iconSize:[40,40], iconAnchor:[20,20] })
              }).addTo(searchLayer).bindPopup(l.getPopup().getContent()).openPopup();
              map.setView(l.getLatLng(), 17);
              togglePanel('search-panel');
            };
            resDiv.appendChild(item);
          }
        });
      }
    };
  </script>
</body>
</html>
